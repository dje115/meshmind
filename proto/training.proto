syntax = "proto3";
package meshmind.training;
import "common.proto";

message DatasetManifest {
  string manifest_id = 1;
  meshmind.common.HashRef from_event_hash = 2;
  meshmind.common.HashRef to_event_hash = 3;
  repeated meshmind.common.HashRef cas_objects = 4;
  repeated string notes = 5;

  // Extended fields for provenance
  string source_id = 6;
  string connector_type = 7;
  string preset = 8;
  meshmind.common.HashRef schema_snapshot_ref = 9;
  repeated string redaction_rules = 10;
  uint64 item_count = 11;
  uint64 total_bytes = 12;
}

message TrainConfig {
  string job_id = 1;
  string target = 2;
  uint32 max_steps = 3;
  uint32 max_minutes = 4;
  uint32 max_dataset_items = 5;
  uint32 max_threads = 6;
  string dataset_preset = 7;
  meshmind.common.HashRef dataset_manifest_ref = 8;
}

message Metric { string name = 1; double value = 2; }

message TrainResult {
  string job_id = 1;
  bool success = 2;
  repeated Metric metrics = 3;
  meshmind.common.HashRef model_bundle_ref = 4;
  string notes = 5;
}

// Evaluation gate criteria for model promotion.
message EvalGate {
  string metric_name = 1;
  double min_threshold = 2;
  double max_threshold = 3;
  bool must_improve_over_baseline = 4;
}

message EvalResult {
  string model_id = 1;
  string version = 2;
  repeated Metric metrics = 3;
  repeated EvalGateResult gate_results = 4;
  bool all_gates_passed = 5;
}

message EvalGateResult {
  string metric_name = 1;
  double actual_value = 2;
  double threshold = 3;
  bool passed = 4;
}
